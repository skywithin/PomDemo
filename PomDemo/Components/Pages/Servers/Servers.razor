@page "/servers"

@rendermode InteractiveServer

<h3>Servers</h3>
<br />
<br />

<CityListComponent
	@ref="cityListComponent"
	SelectCityCallback="HandleCitySelected" />

<br />

<SearchBarComponent
	@ref="searchBarComponent"
	SearchServerCallback="HandleSearch"
	data-testid="t-servers.searchbar"/>

<br />

<CascadingValue Name="SelectedCity" Value="@this.selectedCity">
	<ServerListComponent
		@rendermode="InteractiveServer"
		SelectedCity="@this.selectedCity"
		SearchFilter="@this.searchFilter" />
</CascadingValue>

<p>
	<a href="/servers/add" class="btn btn-primary">Add Server</a>
</p>

@code {
	private IEnumerable<string> cities = CitiesRepository.GetCities();
	private string selectedCity = "";
	private string searchFilter = "";
	private CityListComponent? cityListComponent;
	private SearchBarComponent? searchBarComponent;

	private void HandleCitySelected(string selectedCity)
	{
		this.selectedCity = selectedCity;
		this.searchFilter = "";

		searchBarComponent?.ClearSearchBar();
	}

	private void HandleSearch(string searchFilter)
	{
		this.searchFilter = searchFilter;

		cityListComponent?.ClearSelection();
	}
}
